# GlitchTip Helm Chart Values
# Chart: glitchtip/glitchtip v7.0.0
# Reference: https://gitlab.com/glitchtip/glitchtip-helm-chart

image:
  repository: glitchtip/glitchtip
  tag: v5.2.0
  pullPolicy: IfNotPresent

# Use existing secret for SECRET_KEY (must be named "glitchtip" for chart)
existingSecret: glitchtip

env:
  normal:
    GLITCHTIP_DOMAIN: https://glitchtip.ops.last-try.org
    ENABLE_USER_REGISTRATION: "false"
    ENABLE_ORGANIZATION_CREATION: "false"
    CELERY_WORKER_AUTOSCALE: "1,2"
    CELERY_WORKER_MAX_TASKS_PER_CHILD: "10000"
    # Email disabled for now
    EMAIL_BACKEND: django.core.mail.backends.console.EmailBackend
    # OIDC via Dex
    SOCIALACCOUNT_PROVIDERS__openid_connect__APPS__0__name: "Dex"
    SOCIALACCOUNT_PROVIDERS__openid_connect__APPS__0__provider_id: "dex"
    SOCIALACCOUNT_PROVIDERS__openid_connect__APPS__0__client_id: "glitchtip"
    SOCIALACCOUNT_PROVIDERS__openid_connect__APPS__0__settings__server_url: "https://auth.ops.last-try.org"
  secret: {}

# External PostgreSQL (CloudNativePG)
# Database URL constructed from secret
migrationJob:
  enabled: true
  database:
    existingSecret: glitchtip-postgres-app
    existingSecretKey: uri

# Disable bundled PostgreSQL
postgresql:
  enabled: false

# External Redis/Valkey
# SAP Valkey Operator creates services/secrets as valkey-{instance-name}-*
redis:
  enabled: false

# Web component
web:
  replicaCount: 1
  database:
    existingSecret: glitchtip-postgres-app
    existingSecretKey: uri
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      memory: 512Mi
  autoscaling:
    enabled: false
  budget:
    minAvailable: 0
  affinity: {}

# Worker component
worker:
  enabled: true
  replicaCount: 1
  database:
    existingSecret: glitchtip-postgres-app
    existingSecretKey: uri
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      memory: 512Mi
  autoscaling:
    enabled: false

# Beat component (scheduled tasks)
beat:
  enabled: true
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      memory: 256Mi

# Flower (Celery monitoring) - disabled
flower:
  enabled: false

# Ingress managed separately
ingress:
  enabled: false
