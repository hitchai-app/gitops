---
# ServiceAccount for MinIOJob
apiVersion: v1
kind: ServiceAccount
metadata:
  name: minio-bucket-sa
  namespace: minio-infra
---
# PolicyBinding grants access to MinIO tenant
apiVersion: sts.min.io/v1alpha1
kind: PolicyBinding
metadata:
  name: minio-bucket-binding
  namespace: minio-infra
spec:
  application:
    serviceaccount: minio-bucket-sa
    namespace: minio-infra
  policies:
    - consoleAdmin
---
# Bucket declarations for infrastructure services
# NOTE: MinIOJob must be in same namespace as tenant (cross-namespace not supported)
apiVersion: job.min.io/v1alpha1
kind: MinIOJob
metadata:
  name: infra-buckets
  namespace: minio-infra
spec:
  serviceAccountName: minio-bucket-sa
  tenant:
    name: infra
    namespace: minio-infra
  failureStrategy: continueOnFailure
  commands:
    - op: make-bucket
      name: create-actions-cache
      args:
        name: actions-cache
