# ClickHouse TLS configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: sentry-clickhouse-tls-config
  namespace: sentry-system
data:
  tls.xml: |
    <clickhouse>
      <openSSL>
        <server>
          <!-- Certificate file -->
          <certificateFile>/etc/clickhouse-server/tls/server.crt</certificateFile>
          <!-- Private key file -->
          <privateKeyFile>/etc/clickhouse-server/tls/server.key</privateKeyFile>
          <!-- CA certificate (for client verification) -->
          <caConfig>/etc/clickhouse-server/tls/ca.crt</caConfig>
          <!-- Require client certificate verification -->
          <verificationMode>strict</verificationMode>
          <loadDefaultCAFile>false</loadDefaultCAFile>
          <cacheSessions>true</cacheSessions>
          <disableProtocols>sslv2,sslv3</disableProtocols>
          <preferServerCiphers>true</preferServerCiphers>
        </server>
        <client>
          <!-- For ClickHouse to connect to other nodes (future multi-node) -->
          <loadDefaultCAFile>false</loadDefaultCAFile>
          <caConfig>/etc/clickhouse-server/tls/ca.crt</caConfig>
          <cacheSessions>true</cacheSessions>
          <disableProtocols>sslv2,sslv3</disableProtocols>
          <preferServerCiphers>true</preferServerCiphers>
          <verificationMode>require</verificationMode>
        </client>
      </openSSL>
    </clickhouse>
