apiVersion: clickhouse.altinity.com/v1
kind: ClickHouseInstallation
metadata:
  name: sentry
  namespace: sentry-system
spec:
  taskID: "2026-01-17-1840"
  configuration:
    clusters:
      - name: sentry
        layout:
          replicasCount: 1
        templates:
          podTemplate: clickhouse
          volumeClaimTemplate: data
    users:
      default:
        networks:
          ip:
            - 127.0.0.1
            - "::1"
      sentry/password_sha256_hex:
        valueFrom:
          secretKeyRef:
            name: sentry-clickhouse-auth
            key: clickhouse-password-sha256
      sentry/profile: default
      sentry/quota: default
      sentry/networks/ip:
        - 0.0.0.0/0
        - "::/0"
  templates:
    podTemplates:
      - name: clickhouse
        spec:
          containers:
            - name: clickhouse
              # Pin ClickHouse to a Snuba-tested version (Altinity stable).
              image: altinity/clickhouse-server:23.8.11.29.altinitystable
              resources:
                requests:
                  cpu: 500m
                  memory: 2Gi
                limits:
                  cpu: 1000m
                  memory: 4Gi
    volumeClaimTemplates:
      - name: data
        spec:
          accessModes:
            - ReadWriteOnce
          storageClassName: single-replica
          resources:
            requests:
              storage: 50Gi
