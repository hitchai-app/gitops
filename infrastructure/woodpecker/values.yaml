# Woodpecker CI Helm Chart Values
# Chart: woodpecker-ci/woodpecker
# Reference: https://woodpecker-ci.org/docs/administration/installation/helm-chart

# Server component
server:
  enabled: true

  env:
    WOODPECKER_HOST: https://ci.ops.last-try.org
    WOODPECKER_OPEN: "false"
    WOODPECKER_ADMIN: admin
    # Forgejo integration
    WOODPECKER_FORGEJO: "true"
    WOODPECKER_FORGEJO_URL: https://git.ops.last-try.org
    WOODPECKER_FORGEJO_SKIP_VERIFY: "false"

  extraSecretNamesForEnvFrom:
    - woodpecker-secrets

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      memory: 256Mi

  # Ingress managed separately
  ingress:
    enabled: false

  service:
    type: ClusterIP
    port: 80

  # Persistent storage for SQLite database
  persistentVolume:
    enabled: true
    size: 1Gi
    storageClass: single-replica

# Agent component
agent:
  enabled: true
  replicaCount: 1

  env:
    WOODPECKER_SERVER: woodpecker-server:9000
    WOODPECKER_BACKEND: kubernetes
    WOODPECKER_BACKEND_K8S_NAMESPACE: woodpecker-system
    WOODPECKER_BACKEND_K8S_STORAGE_CLASS: single-replica
    WOODPECKER_BACKEND_K8S_VOLUME_SIZE: 1G

  extraSecretNamesForEnvFrom:
    - woodpecker-secrets

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      memory: 256Mi

  serviceAccount:
    create: true
    rbac:
      create: true
