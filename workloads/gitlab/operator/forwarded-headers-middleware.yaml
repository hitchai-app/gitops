# Traefik Middleware to ensure X-Forwarded-Proto: https reaches backend
# Required for ActionCable origin validation (allow_same_origin_as_host=true)
# ActionCable compares request Origin (https://...) with rack.url_scheme
# Without proper X-Forwarded-Proto, Rails sees http scheme, origin check fails â†’ 404
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: forwarded-headers
  namespace: gitlab-system
spec:
  headers:
    customRequestHeaders:
      X-Forwarded-Proto: "https"
